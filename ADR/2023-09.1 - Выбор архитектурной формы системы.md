**Дата:** 24 декабря 2025 г.  
**Статус:** On Review

# Контекст

Проект «Платформа для Трейдинга» должен обеспечивать:

- отображение актуальных котировок в режиме реального времени;
- создание и исполнение торговых ордеров;
- управление портфелем и историю сделок;
- аналитические инструменты (графики, индикаторы), уведомления и автоматические стратегии;
- высокую доступность 24/7, безопасность и возможность масштабирования при росте нагрузки.

Система также должна поддерживать интеграции с брокерскими платформами и банками. Требуется выбрать архитектурную форму, которая позволит развивать функциональность по модулям и при этом держать низкие задержки в критичных операциях (создание/исполнение ордеров).

# Рассмотренные варианты

## 1) Модульный монолит
Единое приложение, разделённое на модули по функциональным зонам (котировки, ордера, портфель, аналитика, пользователи, уведомления).

## 2) Микросервисная архитектура
Функциональные зоны вынесены в отдельные сервисы (Market Data, Order Management, Portfolio, Users/Auth, Notifications, Analytics).

## 3) Событийно-ориентированные микросервисы (EDA)
Микросервисы + обмен доменными событиями через брокер сообщений (например, «ОрдерСоздан», «СделкаИсполнена», «ПортфельОбновлён»). Команды обрабатываются синхронно (API), события — асинхронно (шина событий).

## 4) Serverless архитектура
Функции выполняются по событиям (создание ордера → триггер), минимальная инфраструктура, упор на managed-сервисы.

# Решение

Выбрана **событийно-ориентированная микросервисная архитектура (EDA)**.

# Обоснование

- **Низкая задержка в критичных сценариях**: контур ордеров и исполнения можно оптимизировать отдельно от аналитики/форума/уведомлений.
- **Масштабируемость по «горячим» зонам**: Market Data и Notifications масштабируются независимо.
- **Устойчивость**: асинхронные доменные события позволяют перераспределять нагрузку и переживать временные сбои интеграций.
- **Изоляция рисков**: ошибки в некритичных подсистемах (форум/аналитика) меньше влияют на контур торгов.
- **Эволюционность**: новые функции (стратегии, рекомендации) подключаются подпиской на события без изменения критичного ядра.

# Недостатки

- Выше сложность инфраструктуры (оркестрация, наблюдаемость, трассировка).
- Возникает **eventual consistency** между сервисами (нужно проектировать идемпотентность и повторную обработку событий).
- Сложнее тестирование: контрактные/интеграционные тесты, тестовые стенды.

# Последствия

- Вводится **API Gateway/BFF** для клиентских приложений (Web/Mobile) и маршрутизации запросов.
- Внутренние взаимодействия: синхронно (HTTP/gRPC) для команд, асинхронно (message broker) для событий.
- Нужны стандарты: схема событий, версияция, корреляция (trace-id), политика ретраев/дедупликации.
- Требуется базовый набор observability: централизованные логи, метрики, распределённый трейсинг.
