**Дата:** 24 декабря 2025 г.  
**Статус:** Принято

# Контекст

Платформа для трейдинга хранит:

- пользователей и роли;
- ордера, сделки, позиции и портфели (критичные транзакционные данные);
- историю операций и отчёты;
- кэш котировок/потоковые данные для realtime-интерфейса.

Нужны: ACID-гарантии для ордеров и сделок, поддержка сложных запросов (отчётность, фильтры по истории), удобное масштабирование чтения и резервное копирование.

# Рассмотренные варианты

1. **PostgreSQL** — надёжная объектно-реляционная СУБД с сильными транзакциями, богатым SQL и расширениями.
2. **MySQL** — популярная реляционная СУБД, хороша для многих сценариев, но меньше возможностей расширения под сложные запросы.
3. **MongoDB** — удобна для документов, но хуже подходит как единственный источник истины для финансовых транзакций.
4. **CockroachDB** — распределённая SQL-СУБД с транзакциями, но выше операционная сложность.
5. **Полиглотное хранение** (SQL + отдельная time-series/OLAP БД) — лучше по специализированным задачам, но сложнее в эксплуатации.

# Решение

Выбран **PostgreSQL** как основная транзакционная база данных.  
Дополнительно используется **Redis** как кэш/хранилище сессий и краткоживущих realtime-данных.

# Обоснование

- **ACID и надёжность** — критично для ордеров/сделок/портфелей.
- **Богатый SQL** — удобно для отчётности, аналитических выборок по истории сделок и портфеля.
- **Расширяемость** — возможности партиционирования, индексации, JSONB, расширения под time-series (при необходимости).
- **Экосистема и инструменты** — бэкапы, репликация, мониторинг, миграции.

# Недостатки

- Для очень высокочастотных потоков котировок может потребоваться отдельное специализированное хранилище (time-series/OLAP).
- Требует дисциплины в проектировании схемы (индексы, партиции, миграции).

# Последствия

- Финансовые операции фиксируются в PostgreSQL как «источнике истины».
- Redis применяется для ускорения чтения (котировки, агрегаты, rate-limit, сессии).
- Для роста нагрузки планируется: репликация чтения, партиционирование таблиц истории, выделение хранилища market-data при необходимости.
